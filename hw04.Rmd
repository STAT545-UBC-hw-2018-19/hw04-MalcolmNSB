---
title: "HW04: Tidy data and joins"
output: 
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Data reshaping

**Problem:** You have data in one “shape” but you wish it were in another. Usually this is because the alternative shape is superior for presenting a table, making a figure, or doing aggregation and statistical analysis.

**Solution:** Reshape your data. For simple reshaping, gather() and spread() from tidyr will suffice. Do the thing that is possible / easier now that your data has a new shape.

**Prompt:** Make a tibble with one row per year and columns for life expectancy for two or more countries from gapminder. 



First we load the tidyverse package and gapminder dataframe.
```{r}
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(gapminder))
```

###La vie en france, ou au royaume-uni ?

Let's explore the trend in life expectancy for France versus the United Kingdom!

```{r}
#create tibble fr_uk_lifeExp consisting of filtered gapminder data
fr_uk_lifeExp <- gapminder %>% 
  
  #capitalise year for aesthetic purposes
  rename(Year = year) %>% 
  
  #filter gapminder to France & United Kingdom
  filter(country == "France" | country == "United Kingdom") %>% 
  
  #select year, country, and life expectancy
  select(Year, country, lifeExp) %>% 
  
  #spread the life expectancy data by country
  spread(key = "country", value = "lifeExp")

#produce nice table
knitr::kable(fr_uk_lifeExp)
```
 
- Take advantage of this new data shape to scatterplot life expectancy for one country against that of another.
```{r}
#plot United Kingdom life expectancy against that of France
fr_uk_lifeExp %>% 
ggplot(aes(`United Kingdom`, France)) +
  
  #make scatter plot
  geom_point() +
  
  #interpolate using smooth curve
  geom_smooth(method = loess) +
  
  #plot title
  ggtitle("Life expectancy trend of United Kingdom versus France, 1952-2007")
```

##Join Prompts

**Problem:** You have two data sources and you need info from both in one new data object.

**Solution:** Perform a join, which borrows terminology from the database world, specifically SQL.

Prompts:

Activity #1

Create a second data frame, complementary to Gapminder. Join this with (part of) Gapminder using a dplyr join function and make some observations about the process and result. Explore the different types of joins. Examples of a second data frame you could build:
        One row per country, a country variable and one or more variables with extra info, such as language spoken, NATO membership, national animal, or capitol city.
        One row per continent, a continent variable and one or more variables with extra info, such as northern versus southern hemisphere.
        
We shall build a second data frame of countries Canada, United Kingdom, France, and Russia, with national animal, NATO membership. Note that we specifically chose Russia because it is NOT contained in the gapminder data frame. 


```{r}
#Creating our own tibble

#column of chosen countries
countries <- c("Canada", "United Kingdom", "France", "Russia")

#column of continents corresponding to chosen countries
continent<- c("Americas", "Europe", "Europe", "Asia") 

#column of national animal of corresponding country
Anim <- c("Beaver", "Lion", "Gallic Rooster", "Bear") 

#column of NATO membership
NATO <- c("Yes", "Yes", "Yes", "No") 

#column of Capital city
Cap <- c("Ottawa", "London", "Paris", "Moscow") 

#create the tibble `addinfo` consisting of all the above columns
addinfo <- tibble(continent = continent, country = countries,  `national animal` = Anim, `NATO membership` = NATO, `capital city` = Cap)

knitr::kable(addinfo)
```
We shall also create a filtered subset of gapminder tibble, which will include Canada, France, United Kingdom, and Norway. Note we added Norway because it is not contained in our data frame constructed earlier.

```{r}
#filter gapminder dataset to year 2007, 
#and the countries in the countries column created earlier,
#but include Norway
gapfilt <- gapminder %>% 
  filter(year == 2007, country%in%countries | country == "Norway") %>% 
  
  #select subset of data in 2007 (for simplicity)
  select(continent, country, lifeExp)

knitr::kable(gapfilt)
```
The two data frames have two columns in common: continent, and country Let's first see what happens when we left join by country only.

```{r}
#left join by country
left_join(gapfilt, addinfo, by = "country") %>% 
  knitr::kable()
```
We see that left joining by country only, the common column of continent is not automatically recognised - instead they are treated as two distinct columns and automatically ".x" and ".y" demarcations.

```{r}
left_join(gapfilt, addinfo) %>% 
  knitr::kable()
```
```{r}
left_join(addinfo, gapfilt) %>% 
  knitr::kable()
```



```{r}
right_join(gapfilt, addinfo) %>% 
  knitr::kable()
```

```{r}
right_join(addinfo, gapfilt)
```

```{r}
right_join(gapfilt, addinfo) %>% 
  knitr::kable()
```

```{r}
inner_join(gapfilt, addinfo) %>% 
  knitr::kable()
```


```{r}
inner_join(addinfo, gapfilt)
```

```{r}
full_join(gapfilt, addinfo) %>% 
  knitr::kable()
```

```{r}
bind_rows(gapfilt, addinfo) %>% 
  knitr::kable()
```


```{r}
full_join(addinfo, gapfilt) %>% 
  knitr::kable()
```


```{r}
semi_join(gapfilt, addinfo) %>% 
  knitr::kable()
```

```{r}
semi_join(addinfo, gapfilt) %>% 
  knitr::kable()
```


```{r}
anti_join(gapfilt, addinfo) %>% 
  knitr::kable()
```

```{r}
anti_join(addinfo, gapfilt) %>% 
  knitr::kable()
```

```{r}
bind_cols(gapfilt, addinfo) %>% 
  knitr::kable()
```



```{r}
a <- select(gapfilt, continent, country)
b <- select(addinfo, continent, country)

knitr::kable(a)
knitr::kable(b)
```

```{r}
intersect(a,b) %>% 
  knitr::kable()
```

```{r}
union(a,b) %>% 
  knitr::kable()
```

```{r}
setdiff(a,b) %>% 
  knitr::kable()
```

```{r}
setdiff(b,a) %>% 
  knitr::kable()
```


##Exploring merge function
For simplicity we work with the following tibbles

```{r}
(a <- tibble(x1 = LETTERS[1:3], x2 = 1:3))
(b <- tibble(x1 = LETTERS[c(1,2)], x3 = c("T", "F")))
```
```{r}
merge(a,b)
left_join(a,b)
right_join(a,b)
merge(b,a)
merge(a,b, by = "x1")
```
```{r}
match(a,b)
match(b,a)
```



